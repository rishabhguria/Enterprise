<?xml version="1.0" encoding="UTF-8"?>
<!--
This file was generated by Altova MapForce 2007

YOU SHOULD NOT MODIFY THIS FILE, BECAUSE IT WILL BE
OVERWRITTEN WHEN YOU RE-RUN CODE GENERATION.

Refer to the Altova MapForce 2007 Documentation for further details.
http://www.altova.com/mapforce
-->
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xs="http://www.w3.org/2001/XMLSchema" exclude-result-prefixes="xs">
	<xsl:output method="xml" encoding="UTF-8" indent="yes"/>

	<xsl:template name="spaces">
		<xsl:param name="count"/>
		<xsl:if test="number($count)">
			<xsl:call-template name="spaces">
				<xsl:with-param name="count" select="$count - 1"/>
			</xsl:call-template>
		</xsl:if>
		<xsl:value-of select="' '"/>
	</xsl:template>


			<xsl:template match="/NewDataSet">
		<ThirdPartyFlatFileDetailCollection>
			<xsl:attribute name="xsi:noNamespaceSchemaLocation">C:/UpdatedTP/Prana_Final.xsd</xsl:attribute>
			<xsl:for-each select="ThirdPartyFlatFileDetail[Fund = '40 Act - Absolute Return' or Fund = '40 Act - LongShort' or Fund = '40 Act - Trust' or Fund = 'UCITS - Absolute Return' or Fund = 'UCITS - LongShort' ]">
				<ThirdPartyFlatFileDetail>

					<RowHeader>
						<xsl:value-of select ="'false'"/>
					</RowHeader>

					<FileHeader>
						<xsl:value-of select="'true'"/>
					</FileHeader>

					<FileFooter>
						<xsl:value-of select="'true'"/>
					</FileFooter>

					<TaxlotState>
						<xsl:value-of select ="TaxLotState"/>
					</TaxlotState>

					<xsl:variable name="PB_NAME" select="'NAV'"/>
					
					<xsl:variable name = "PRANA_FUND_NAME">
						<xsl:value-of select="Fund"/>
					</xsl:variable>

					<xsl:variable name ="THIRDPARTY_FUND_CODE">
						<xsl:value-of select ="document('../ReconMappingXml/FundMapping.xml')/FundMapping/PB[@Name=$PB_NAME]/FundData[@PranaFund=$PRANA_FUND_NAME]/@PBFundCode"/>					
					</xsl:variable>

					<xsl:variable name ="PBAccountSpace">
						<xsl:call-template name="spaces">
							<xsl:with-param name="count" select="(7) - string-length($THIRDPARTY_FUND_CODE)" />
						</xsl:call-template>
					</xsl:variable>
					
					<xsl:variable name ="varAccountName">
						<xsl:choose>
							<xsl:when test="$THIRDPARTY_FUND_CODE != ''">
								<xsl:value-of select="concat($THIRDPARTY_FUND_CODE,$PBAccountSpace)"/>
							</xsl:when>
							<xsl:otherwise>
								<xsl:value-of select="'        '"/>
							</xsl:otherwise>
						</xsl:choose>
					</xsl:variable>

					<xsl:variable name="AccountCurrency">
						<xsl:value-of select="concat('Y',Currency)"/>
					</xsl:variable>

					<xsl:variable name="varAccountNAV">
						<xsl:value-of select="AccountNAV"/>
					</xsl:variable>

					<xsl:variable name ="varAccountNAVSpaces">
						<xsl:call-template name="spaces">
							<xsl:with-param name="count" select="(18) - string-length($varAccountNAV)" />
						</xsl:call-template>
					</xsl:variable>

					<!-- Account Type will always be blank and will contain 2 spaces as per doc and our conversation with Mike (US Team member)-->
					<xsl:variable name="varAccountType">
						<xsl:value-of select="'  '"/>
					</xsl:variable>
					
					<DataFile>
						<xsl:value-of select="concat($varAccountName,$AccountCurrency,$varAccountNAVSpaces,$varAccountNAV,$varAccountType)"/>
					</DataFile>

					<EntityID>
						<xsl:value-of select="EntityID"/>
					</EntityID>

				</ThirdPartyFlatFileDetail>
			</xsl:for-each>
		</ThirdPartyFlatFileDetailCollection>
	</xsl:template>
</xsl:stylesheet>
