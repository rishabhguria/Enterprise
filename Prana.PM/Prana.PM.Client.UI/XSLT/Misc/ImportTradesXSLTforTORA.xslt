<?xml version="1.0" encoding="UTF-8"?>
<!--
This file was generated by Altova MapForce 2007

YOU SHOULD NOT MODIFY THIS FILE, BECAUSE IT WILL BE
OVERWRITTEN WHEN YOU RE-RUN CODE GENERATION.

Refer to the Altova MapForce 2007 Documentation for further details.
http://www.altova.com/mapforce
-->
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xs="http://www.w3.org/2001/XMLSchema" exclude-result-prefixes="xs">
	<xsl:output method="xml" encoding="UTF-8" indent="yes"/>
	<xsl:template match="/DocumentElement">
		<DocumentElement>
			<xsl:attribute name="xsi:noNamespaceSchemaLocation">C:/UpdatedTP/ThirdPartyOne_Final.xsd</xsl:attribute>
			<xsl:for-each select="EMSTrades">
				<EMSTrades>
					<!--   SIDE -->

					<xsl:if test="Side='BUY'">
						<xsl:for-each select="Side">
							<Side>
								<xsl:value-of select="'Buy'"/>
							</Side>
						</xsl:for-each>
					</xsl:if>
					<xsl:if test="Side='SELL'">
						<xsl:for-each select="Side">
							<Side>
								<xsl:value-of select="'Sell'"/>
							</Side>
						</xsl:for-each>
					</xsl:if>

					<xsl:if test="Side='SHORT'">
						<xsl:for-each select="Side">
							<Side>
								<xsl:value-of select="'Sell short'"/>
							</Side>
						</xsl:for-each>
					</xsl:if>

					<xsl:if test="Side='BTC'">
						<xsl:for-each select="Side">
							<Side>
								<xsl:value-of select="'Buy To Close'"/>
							</Side>
						</xsl:for-each>
					</xsl:if>

					<!--  END  SIDE -->

					<!--   SYMBOL -->

					<xsl:for-each select="Code">
						<Symbol>
							<xsl:value-of select="."/>
						</Symbol>
					</xsl:for-each>
					<!--

				<xsl:for-each select="SideID">
						<SideID>
							<xsl:value-of select="."/>
						</SideID>
					</xsl:for-each>    -->



					<xsl:for-each select="OrderID">
						<OrderID>
							<xsl:value-of select="."/>
						</OrderID>
					</xsl:for-each>

					<xsl:for-each select="OrderQty">
						<OrderQty>
							<xsl:value-of select="."/>
						</OrderQty>
					</xsl:for-each>



					<xsl:for-each select="OrderPrice">
						<Price>
							<xsl:value-of select="."/>
						</Price>
					</xsl:for-each>

					<xsl:for-each select="Timestamp">
						<ServerTime>
							<xsl:value-of select="."/>
						</ServerTime>
					</xsl:for-each>


					<xsl:for-each select="ExecutionTime">
						<ExecutionTime>
							<xsl:value-of select="."/>
						</ExecutionTime>
					</xsl:for-each>

					<xsl:for-each select="ExecutionQty">
						<ExecutionQty>
							<xsl:value-of select="."/>
						</ExecutionQty>
					</xsl:for-each>

					<xsl:for-each select="ExecutionPrice">
						<ExecutionPrice>
							<xsl:value-of select="."/>
						</ExecutionPrice>
					</xsl:for-each>

					<xsl:for-each select="EX">
						<EX>
							<xsl:value-of select="."/>
						</EX>
					</xsl:for-each>

					<xsl:for-each select="Account">
						<Account>
							<xsl:value-of select="."/>
						</Account>
					</xsl:for-each>

					<xsl:for-each select="Condition">
						<Condition>
							<xsl:value-of select="."/>
						</Condition>
					</xsl:for-each>




					<xsl:for-each select="Owner">
						<Owner>
							<xsl:value-of select="."/>
						</Owner>
					</xsl:for-each>

					<xsl:for-each select="Originator">
						<Originator>
							<xsl:value-of select="."/>
						</Originator>
					</xsl:for-each>

					<xsl:for-each select="TransactionID">
						<TransactionID>
							<xsl:value-of select="."/>
						</TransactionID>
					</xsl:for-each>

					<xsl:for-each select="ISIN">
						<ISIN>
							<xsl:value-of select="."/>
						</ISIN>
					</xsl:for-each>

					<xsl:for-each select="SEDOL">
						<SEDOL>
							<xsl:value-of select="."/>
						</SEDOL>
					</xsl:for-each>

					<xsl:for-each select="BBCode">
						<BBCode>
							<xsl:value-of select="."/>
						</BBCode>
					</xsl:for-each>

					<xsl:for-each select="RIC">
						<RIC>
							<xsl:value-of select="."/>
						</RIC>
					</xsl:for-each>

					<xsl:for-each select="LotSize">
						<LotSize>
							<xsl:value-of select="."/>
						</LotSize>
					</xsl:for-each>

					<xsl:for-each select="CommBPS">
						<CommBPS>
							<xsl:value-of select="."/>
						</CommBPS>
					</xsl:for-each>

					<xsl:for-each select="CommFEE">
						<CommFEE>
							<xsl:value-of select="."/>
						</CommFEE>
					</xsl:for-each>

					<!--broker is used for counterparty as well as venue...we need to sort that if 
          some mapping is needed or hardcoding would do
          -->
					<xsl:if test="Broker='DB'">
						<xsl:for-each select="Broker">
							<Broker>
								<xsl:value-of select="'MS'"/>
							</Broker>
						</xsl:for-each>
					</xsl:if>
					
					<xsl:if test="Broker='UBS'">
						<xsl:for-each select="Broker">
							<Broker>
								<xsl:value-of select="'MS'"/>
							</Broker>
						</xsl:for-each>
					</xsl:if>

					<xsl:if test="Broker='DB'">
						<xsl:for-each select="Broker">
							<Venue>
								<xsl:value-of select="'NASDAQ'"/>
							</Venue>
						</xsl:for-each>
					</xsl:if>
					<xsl:if test="Broker='UBS'">
						<xsl:for-each select="Broker">
							<Venue>
								<xsl:value-of select="'NASDAQ'"/>
							</Venue>
						</xsl:for-each>
					</xsl:if>
					
          <xsl:choose>
            <xsl:when test="RIC = '*'">
              <xsl:for-each select="Owner">
                <TradingAccount>
                  <xsl:value-of select="''"/>
                </TradingAccount>
              </xsl:for-each>
            </xsl:when>

            <xsl:otherwise>
                <xsl:for-each select="Owner">
                  <TradingAccount>
                    <xsl:value-of select="'11'"/>
                  </TradingAccount>
                </xsl:for-each>
            </xsl:otherwise>
          </xsl:choose>
          
          <xsl:for-each select="Description">
						<CompanyName>
							<xsl:value-of select="."/>
						</CompanyName>
					</xsl:for-each>
				</EMSTrades>
			</xsl:for-each>
		</DocumentElement>
	</xsl:template>
</xsl:stylesheet>
