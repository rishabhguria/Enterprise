<?xml version="1.0" encoding="UTF-8"?>
<!--
This file was generated by Altova MapForce 2007

YOU SHOULD NOT MODIFY THIS FILE, BECAUSE IT WILL BE
OVERWRITTEN WHEN YOU RE-RUN CODE GENERATION.

Refer to the Altova MapForce 2007 Documentation for further details.
http://www.altova.com/mapforce
-->
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xs="http://www.w3.org/2001/XMLSchema" exclude-result-prefixes="xs">
	<xsl:output method="xml" encoding="UTF-8" indent="yes"/>
	<xsl:template match="/ThirdPartyFlatFileDetailCollection">
		<ThirdPartyFlatFileDetailCollection>
			<xsl:attribute name="xsi:noNamespaceSchemaLocation">C:/UpdatedTP/Prana_Final.xsd</xsl:attribute>
			<xsl:for-each select="ThirdPartyFlatFileDetail">
				<ThirdPartyFlatFileDetail>

					<GroupAllocationReq>
						<xsl:value-of select ="'true'"/>
					</GroupAllocationReq>
					<FileHeader>
						<xsl:value-of select ="'true'"/>
					</FileHeader>
					<FileFooter>
						<xsl:value-of select ="'true'"/>
					</FileFooter>
					<RowHeader>
						<xsl:value-of select ="'false'"/>
					</RowHeader>
					<xsl:for-each select="CompanyID">
						<CompanyID>
							<xsl:value-of select="."/>
						</CompanyID>
					</xsl:for-each>
					<xsl:for-each select="ThirdPartyID">
						<ThirdPartyID>
							<xsl:value-of select="."/>
						</ThirdPartyID>
					</xsl:for-each>

					<TaxlotState>
						<xsl:value-of select ="TaxLotState"/>
					</TaxlotState>

					<orderlabel>
						<xsl:value-of select="'ORDER'"/>
					</orderlabel>

					<premise>
						<xsl:value-of select ="'PB0n'"/>
					</premise>

					<PBUniqueID>
						<xsl:value-of select ="PBUniqueID"/>
					</PBUniqueID>

					<order_number>
						<xsl:value-of select="PBUniqueID"/>
					</order_number>

					<xsl:variable name = "varMthTrade" >
						<xsl:value-of select="substring-before(TradeDate,'/')"/>
					</xsl:variable>
					<xsl:variable name = "varDateYrTrade" >
						<xsl:value-of select="substring-after(TradeDate,'/')"/>
					</xsl:variable>
					<xsl:variable name = "varYRTrade" >
						<xsl:value-of select="substring-after($varDateYrTrade,'/')"/>
					</xsl:variable>
					<xsl:variable name = "varDtTrade" >
						<xsl:value-of select="substring-before($varDateYrTrade,'/')"/>
					</xsl:variable>
					<xsl:choose>
						<xsl:when test ="string-length($varMthTrade) &lt; 2 and string-length($varDtTrade) &lt; 2">
							<process_dt>
								<xsl:value-of select="concat($varYRTrade,'',concat('0',$varMthTrade),'',concat('0',$varDtTrade))"/>
							</process_dt>
							<trade_dt>
								<xsl:value-of select="concat($varYRTrade,'',concat('0',$varMthTrade),'',concat('0',$varDtTrade))"/>
							</trade_dt>
						</xsl:when>
						<xsl:when test ="string-length($varMthTrade) &lt; 2 and string-length($varDtTrade) = 2">
							<process_dt>
								<xsl:value-of select="concat($varYRTrade,'',concat('0',$varMthTrade),'',$varDtTrade)"/>
							</process_dt>
							<trade_dt>
								<xsl:value-of select="concat($varYRTrade,'',concat('0',$varMthTrade),'',$varDtTrade)"/>
							</trade_dt>
						</xsl:when>
						<xsl:when test ="string-length($varMthTrade) = 2 and string-length($varDtTrade) &lt; 2">
							<process_dt>
								<xsl:value-of select="concat($varYRTrade,'',$varMthTrade,'',concat('0',$varDtTrade))"/>
							</process_dt>
							<trade_dt>
								<xsl:value-of select="concat($varYRTrade,'',$varMthTrade,'',concat('0',$varDtTrade))"/>
							</trade_dt>
						</xsl:when>
						<xsl:otherwise>
							<process_dt>
								<xsl:value-of select="concat($varYRTrade,'',$varMthTrade,'',$varDtTrade)"/>
							</process_dt>
							<trade_dt>
								<xsl:value-of select="concat($varYRTrade,'',$varMthTrade,'',$varDtTrade)"/>
							</trade_dt>
						</xsl:otherwise>
					</xsl:choose>


					<xsl:variable name = "varMthSettle" >
						<xsl:value-of select="substring-before(SettlementDate,'/')"/>
					</xsl:variable>
					<xsl:variable name = "varDateYrSettle" >
						<xsl:value-of select="substring-after(SettlementDate,'/')"/>
					</xsl:variable>
					<xsl:variable name = "varYRSettle" >
						<xsl:value-of select="substring-after($varDateYrSettle,'/')"/>
					</xsl:variable>
					<xsl:variable name = "varDtSettle" >
						<xsl:value-of select="substring-before($varDateYrSettle,'/')"/>
					</xsl:variable>
					<xsl:choose>
						<xsl:when test ="string-length($varMthSettle) &lt; 2">
							<settle_dt>
								<xsl:value-of select="concat($varYRSettle,'',concat('0',$varMthSettle),'',$varDtSettle)"/>
							</settle_dt>
						</xsl:when>
						<xsl:otherwise>
							<settle_dt>
								<xsl:value-of select="concat($varYRTrade,'',$varMthSettle,'',$varDtSettle)"/>
							</settle_dt>
						</xsl:otherwise>
					</xsl:choose>


					<!-- Side Starts-->
					<xsl:for-each select="SideID">
						<SideID>
							<xsl:value-of select="."/>
						</SideID>
					</xsl:for-each>
					<xsl:choose>
						<xsl:when test="Side='Buy' or Side='Buy to Open' ">
							<trans_mne>
								<xsl:value-of select="'BUY'"/>
							</trans_mne>
						</xsl:when>
						<xsl:when test="Side='Buy to Cover' or Side='Buy to Close'">
							<trans_mne>
								<xsl:value-of select="'BCOV'"/>
							</trans_mne>
						</xsl:when>
						<xsl:when test="Side='Sell' or Side='Sell to Close'">
							<trans_mne>
								<xsl:value-of select="'SELL'"/>
							</trans_mne>
						</xsl:when>
						<xsl:when test="Side='Sell short' or Side='Sell to Open'">
							<trans_mne>
								<xsl:value-of select="'SSEL'"/>
							</trans_mne>
						</xsl:when>
						<xsl:otherwise >
							<trans_mne>
								<xsl:value-of select="' '"/>
							</trans_mne>
						</xsl:otherwise>
					</xsl:choose >

					<xsl:choose>
						<xsl:when test ="TaxLotState='Amemded'">
							<activity_cd>
								<xsl:value-of select ="'A'"/>
							</activity_cd>
						</xsl:when>
						<xsl:otherwise>
							<activity_cd>
								<xsl:value-of select ="'N'"/>
							</activity_cd>
						</xsl:otherwise>
					</xsl:choose>


					<custodian_mne>
						<xsl:value-of select ="'GSCO'"/>
					</custodian_mne>

					<!--<prod_id>
						<xsl:value-of select ="CUSIP"/>
					</prod_id>

					<prod_id_type>
						<xsl:value-of select ="'C'"/>
					</prod_id_type>-->

					<xsl:variable name ="varCheckSymbolUnderlying">
						<xsl:value-of select ="substring-before(Symbol,'-')"/>
					</xsl:variable>

					<xsl:choose>
						<xsl:when test="SEDOL != '' and $varCheckSymbolUnderlying != '' and Asset != 'FX'">
							<prod_id>
								<xsl:value-of select="SEDOL"/>
							</prod_id>

							<prod_id_type>
								<xsl:value-of select="'S'"/>
							</prod_id_type>
						</xsl:when>
						<xsl:when test="ISIN != '' and $varCheckSymbolUnderlying != '' and Asset != 'FX'">
							<prod_id>
								<xsl:value-of select="ISIN"/>
							</prod_id>

							<prod_id_type>
								<xsl:value-of select="'I'"/>
							</prod_id_type>
						</xsl:when>
						<xsl:when test="CUSIP != '' and $varCheckSymbolUnderlying != '' and Asset != 'FX'">
							<prod_id>
								<xsl:value-of select="CUSIP"/>
							</prod_id>

							<prod_id_type>
								<xsl:value-of select="'C'"/>
							</prod_id_type>
						</xsl:when>
						<xsl:when test="Asset = 'EquityOption' ">
							<prod_id>
								<xsl:value-of select="OSIOptionSymbol"/>
							</prod_id>

							<prod_id_type>
								<xsl:value-of select="'Y'"/>
							</prod_id_type>
						</xsl:when>
						<xsl:otherwise>
							<prod_id>
								<xsl:value-of select="translate(Symbol,'.','')"/>
							</prod_id>

							<prod_id_type>
								<xsl:value-of select="'Y'"/>
							</prod_id_type>
						</xsl:otherwise>
					</xsl:choose>

					<prod_desc>
						<xsl:value-of select ="' '"/>
					</prod_desc>

					<!-- Starts Asset Type -->
					<xsl:choose>
						<xsl:when test="Asset='Equity'">
							<security_type>
								<xsl:value-of select="'EQ'"/>
							</security_type>
						</xsl:when>
						<xsl:when test="Asset='EquityOption'">
							<security_type>
								<xsl:value-of select="'OPT'"/>
							</security_type>
						</xsl:when>
						<xsl:when test="Asset='FX'">
							<security_type>
								<xsl:value-of select="'FX'"/>
							</security_type>
						</xsl:when>
						<xsl:when test="Asset='FixedIncome'">
							<security_type>
								<xsl:value-of select="'FI'"/>
							</security_type>
						</xsl:when>
						<xsl:otherwise >
							<security_type>
								<xsl:value-of select="' '"/>
							</security_type>
						</xsl:otherwise>
					</xsl:choose>

					<xsl:for-each select="AssetID">
						<AssetID>
							<xsl:value-of select="."/>
						</AssetID>
					</xsl:for-each>

					<!--Ends Asset Type -->
					<exchange>
						<xsl:value-of select="' '"/>
					</exchange>

					<CounterPartyID>
						<xsl:value-of select="CounterPartyID"/>
					</CounterPartyID>

					<xsl:choose>
						<xsl:when test ="CounterParty='GSEC'">
							<trading_cparty_mne>
								<xsl:value-of select="'REDI'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:otherwise >
							<trading_cparty_mne>
								<xsl:value-of select="CounterParty"/>
							</trading_cparty_mne>
						</xsl:otherwise>
					</xsl:choose >
					
					<!--<xsl:variable name = "PRANA_COUNTERPARTY" >
						<xsl:value-of select="CounterParty"/>
					</xsl:variable>
					<xsl:variable name="PB_COUNTERPARTY">
						<xsl:value-of select="document('../ReconMappingXml/ExecBrokerMapping.xml')/BrokerMapping/PB[@Name='GS']/BrokerData[@PranaBroker=$PRANA_COUNTERPARTY]/@GSBroker"/>
					</xsl:variable>

					<xsl:choose>
						<xsl:when test="$PB_COUNTERPARTY=''">
							<trading_cparty_mne>
								<xsl:value-of select ="$PRANA_COUNTERPARTY"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:otherwise>
							<trading_cparty_mne>
								<xsl:value-of select ="$PB_COUNTERPARTY"/>
							</trading_cparty_mne>
						</xsl:otherwise>
					</xsl:choose>
					
					<xsl:choose>
						<xsl:when test ="CounterParty='BMCI'">
							<trading_cparty_mne>
								<xsl:value-of select="'YORKTON'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='Bofa'">
							<trading_cparty_mne>
								<xsl:value-of select="'BOFA'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='Cant'">
							<trading_cparty_mne>
								<xsl:value-of select="'CANTOR'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='CIBC'">
							<trading_cparty_mne>
								<xsl:value-of select="'CIBC'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='CICF'">
							<trading_cparty_mne>
								<xsl:value-of select="'CANACORDCAP'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='CRT'">
							<trading_cparty_mne>
								<xsl:value-of select="'CREDRES'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='CSFB'">
							<trading_cparty_mne>
								<xsl:value-of select="'CSFB'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='Execution'">
							<trading_cparty_mne>
								<xsl:value-of select="'EXECUTION'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='FECC'">
							<trading_cparty_mne>
								<xsl:value-of select="'FIRSTENERGY'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='Griswold'">
							<trading_cparty_mne>
								<xsl:value-of select="'GRISWOLD'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='GS'">
							<trading_cparty_mne>
								<xsl:value-of select="'GSCO'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='GS1'">
							<trading_cparty_mne>
								<xsl:value-of select="'GSNY'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='ITG'">
							<trading_cparty_mne>
								<xsl:value-of select="'ITG'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='Labs'">
							<trading_cparty_mne>
								<xsl:value-of select="'LABR'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='LEHM'">
							<trading_cparty_mne>
								<xsl:value-of select="'LEHM'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='Maxim'">
							<trading_cparty_mne>
								<xsl:value-of select="'MAXWELL'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='Marrion'">
							<trading_cparty_mne>
								<xsl:value-of select="'MERRION'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='Merrion'">
							<trading_cparty_mne>
								<xsl:value-of select="'MERRION'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='MLCO'">
							<trading_cparty_mne>
								<xsl:value-of select="'MLCO'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='MSCO'">
							<trading_cparty_mne>
								<xsl:value-of select="'MSCO'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='Pension'">
							<trading_cparty_mne>
								<xsl:value-of select="'PENSION'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='PETE'">
							<trading_cparty_mne>
								<xsl:value-of select="'PETE'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='RAJA'">
							<trading_cparty_mne>
								<xsl:value-of select="'RAJA'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='SCMC'">
							<trading_cparty_mne>
								<xsl:value-of select="'SCMC'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='TDSI'">
							<trading_cparty_mne>
								<xsl:value-of select="'TDSI'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='Tris'">
							<trading_cparty_mne>
								<xsl:value-of select="'TRIS'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='Wach'">
							<trading_cparty_mne>
								<xsl:value-of select="'FUCM'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='Weed'">
							<trading_cparty_mne>
								<xsl:value-of select="'WEED'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:when test ="CounterParty='GSEC'">
							<trading_cparty_mne>
								<xsl:value-of select="'REDI'"/>
							</trading_cparty_mne>
						</xsl:when>
						<xsl:otherwise >
							<trading_cparty_mne>
								<xsl:value-of select="CounterParty"/>
							</trading_cparty_mne>
						</xsl:otherwise>
					</xsl:choose >-->

					<xsl:for-each select="CurrencyID">
						<CurrencyID>
							<xsl:value-of select="."/>
						</CurrencyID>
					</xsl:for-each>

					<pricing_ccy>
						<xsl:value-of select="' '"/>
					</pricing_ccy>

					<settlement_ccy>
						<xsl:value-of select="CurrencySymbol"/>
					</settlement_ccy>

					<order_price>
						<xsl:value-of select="AveragePrice"/>
					</order_price>

					<orderqty>
						<xsl:value-of select="ExecutedQty"/>
					</orderqty>

					<principal>
						<xsl:value-of select="GrossAmount"/>
					</principal>

					<net_amt_price_ccy>
						<xsl:value-of select="NetAmount"/>
					</net_amt_price_ccy>

					<net_amt_settle_ccy>
						<xsl:value-of select ="'0'"/>
					</net_amt_settle_ccy>

					<exchange_rate>
						<xsl:value-of select ="'0'"/>
					</exchange_rate>

					<exchange_rate_type>
						<xsl:value-of select ="' '"/>
					</exchange_rate_type>

					<total_sec_fees>
						<xsl:value-of select ="'0'"/>
					</total_sec_fees>
					<total_taxes>
						<xsl:value-of select ="'0'"/>
					</total_taxes>
					<total_other_charges>
						<xsl:value-of select="OtherBrokerFee + StampDuty + TransactionLevy + ClearingFee + MiscFees"/>
					</total_other_charges>
					<total_commission>
						<xsl:value-of select ="CommissionCharged + TaxOnCommissions"/>
					</total_commission>

					<accrued_interest>
						<xsl:value-of select ="'0'"/>
					</accrued_interest>

					<agency_principal_ind>
						<xsl:value-of select ="' '"/>
					</agency_principal_ind>

					<clr_agent>
						<xsl:value-of select ="' '"/>
					</clr_agent>

					<country_code>
						<xsl:value-of select ="' '"/>
					</country_code>

					<overide_delvy_instruct>
						<xsl:value-of select ="' '"/>
					</overide_delvy_instruct>

					<pair_off_prod_id>
						<xsl:value-of select ="' '"/>
					</pair_off_prod_id>

					<repo_open_settle_dt>
						<xsl:value-of select ="' '"/>
					</repo_open_settle_dt>

					<repo_maturity_dt>
						<xsl:value-of select ="' '"/>
					</repo_maturity_dt>

					<repo_collateral_qty>
						<xsl:value-of select ="'0'"/>
					</repo_collateral_qty>

					<repo_rate>
						<xsl:value-of select ="'0'"/>
					</repo_rate>

					<repo_interest>
						<xsl:value-of select ="'0'"/>
					</repo_interest>

					<repo_close_amount>
						<xsl:value-of select ="'0'"/>
					</repo_close_amount>

					<repo_coupon_amt>
						<xsl:value-of select ="'0'"/>
					</repo_coupon_amt>

					<open_close_ind>
						<xsl:value-of select ="' '"/>
					</open_close_ind>

					<free_text1>
						<xsl:value-of select ="' '"/>
					</free_text1>

					<GroupEnds>
						<xsl:value-of select ="'GroupEnds'"/>
					</GroupEnds>

					<Allocat>
						<xsl:value-of select ="'ALLOCAT'"/>
					</Allocat>

					<AllocationId>
						<xsl:value-of select ="TradeRefID"/>
					</AllocationId>

					<trading_acc_mne>
						<xsl:value-of select="AccountNo"/>
					</trading_acc_mne>

					<order_qty>
						<xsl:value-of select ="AllocatedQty"/>
					</order_qty>

					<Allocent>
						<xsl:value-of select ="'ALLOCENT'"/>
					</Allocent>


					<!--Id Fields Not for Save -->
					<xsl:for-each select="CompanyAccountID">
						<CompanyFundID>
							<xsl:value-of select="."/>
						</CompanyFundID>
					</xsl:for-each>

					<xsl:for-each select="ExchangeID">
						<ExchangeID>
							<xsl:value-of select="."/>
						</ExchangeID>
					</xsl:for-each>

					<xsl:for-each select="UnderLyingID">
						<UnderLyingID>
							<xsl:value-of select="."/>
						</UnderLyingID>
					</xsl:for-each>

					<xsl:for-each select="AUECID">
						<AUECID>
							<xsl:value-of select="."/>
						</AUECID>
					</xsl:for-each>

					<xsl:for-each select="CommissionRateTypeID">
						<CommissionRateTypeID>
							<xsl:value-of select="."/>
						</CommissionRateTypeID>
					</xsl:for-each>

					<xsl:for-each select="CVID">
						<CVID>
							<xsl:value-of select="."/>
						</CVID>
					</xsl:for-each>

					<xsl:for-each select="CompanyAccountTypeID">
						<CompanyFundTypeID>
							<xsl:value-of select="."/>
						</CompanyFundTypeID>
					</xsl:for-each>

					<xsl:for-each select="ThirdPartyTypeID">
						<ThirdPartyTypeID>
							<xsl:value-of select="."/>
						</ThirdPartyTypeID>
					</xsl:for-each>

					<xsl:for-each select="CompanyCVID">
						<CompanyCVID>
							<xsl:value-of select="."/>
						</CompanyCVID>
					</xsl:for-each>

					<xsl:for-each select="EntityID">
						<EntityID>
							<xsl:value-of select="."/>
						</EntityID>
					</xsl:for-each>
					<xsl:for-each select="OrderID">
						<OrderID>
							<xsl:value-of select="."/>
						</OrderID>
					</xsl:for-each>
					<xsl:for-each select="TradAccntID">
						<TradAccntID>
							<xsl:value-of select="."/>
						</TradAccntID>
					</xsl:for-each>

				</ThirdPartyFlatFileDetail>
			</xsl:for-each>
		</ThirdPartyFlatFileDetailCollection>
	</xsl:template>
</xsl:stylesheet>
