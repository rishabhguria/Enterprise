<?xml version="1.0" encoding="UTF-8"  ?>
<!-- Created with iReport - A designer for JasperReports -->
<!DOCTYPE jasperReport PUBLIC "//JasperReports//DTD Report Design//EN" "http://jasperreports.sourceforge.net/dtds/jasperreport.dtd">
<jasperReport
		 name="Messages"
		 columnCount="1"
		 printOrder="Vertical"
		 orientation="Portrait"
		 pageWidth="595"
		 pageHeight="842"
		 columnWidth="535"
		 columnSpacing="0"
		 leftMargin="30"
		 rightMargin="30"
		 topMargin="20"
		 bottomMargin="20"
		 whenNoDataType="NoPages"
		 isTitleNewPage="false"
		 isSummaryNewPage="true">
	<property name="cameronsystems.report.name" value="Foo" />
	<property name="ireport.scriptlethandling" value="0" />
	<import value="java.util.*" />
	<import value="net.sf.jasperreports.engine.*" />
	<import value="net.sf.jasperreports.engine.data.*" />
	<parameter name="Start_Day" isForPrompting="true" class="java.sql.Timestamp">
		<parameterDescription><![CDATA[The first time to report on. Defaults to today.]]></parameterDescription>
		<defaultValueExpression ><![CDATA[new java.sql.Timestamp((System.currentTimeMillis() / 86400000) * 86400000)]]></defaultValueExpression>
	</parameter>
	<parameter name="End_Day" isForPrompting="true" class="java.sql.Timestamp">
		<parameterDescription><![CDATA[The last time to report on.  Defaults to now.]]></parameterDescription>
		<defaultValueExpression ><![CDATA[new java.sql.Timestamp(System.currentTimeMillis())]]></defaultValueExpression>
	</parameter>
	<queryString><![CDATA[SELECT us.CompID AS OurCompID, them.CompID AS TheirCompID, 
       MIN(m.TimeStamp) AS Time, COUNT(mt.Description) AS MsgCount, 
       mt.Description, m.MsgType, m.Incoming 
FROM Message m, Connection c, Party us, Party them, MsgType mt
WHERE m.ConnectionID = c.ConnectionID
AND m.TimeStamp >= $P{Start_Day}
AND m.TimeStamp <= $P{End_Day}
AND m.MsgType != '0'
AND c.OurPartyID = us.PartyID
AND c.OtherPartyID = them.PartyID
AND m.MsgType = mt.MsgType 
AND m.MessageID != 0
GROUP BY OurCompID, TheirCompID, YEAR(m.TimeStamp), MONTH(m.TimeStamp), DAYOFMONTH(m.TimeStamp), HOUR(m.TimeStamp), MINUTE(m.TimeStamp), mt.Description, m.MsgType, m.Incoming
ORDER BY OurCompID, TheirCompID, NOT Incoming, Time, mt.Description]]></queryString>
	<field name="OURCOMPID" class="java.lang.String"/>
	<field name="THEIRCOMPID" class="java.lang.String"/>
	<field name="TIME" class="java.sql.Timestamp"/>
	<field name="MSGCOUNT" class="java.lang.Integer"/>
	<field name="DESCRIPTION" class="java.lang.String"/>
	<field name="MSGTYPE" class="java.lang.String"/>
	<field name="INCOMING" class="java.lang.Boolean"/>
	<variable name="TotalIncomingMsgCount" class="java.lang.Integer" resetType="Report" calculation="Sum">
		<variableExpression><![CDATA[$F{INCOMING}.booleanValue() ? $F{MSGCOUNT} : new Integer(0)]]></variableExpression>
	</variable>
	<variable name="TotalOutgoingMsgCount" class="java.lang.Integer" resetType="Report" calculation="Sum">
		<variableExpression><![CDATA[!$F{INCOMING}.booleanValue() ? $F{MSGCOUNT} : new Integer(0)]]></variableExpression>
	</variable>
		<group  name="ConnectionGroup" isStartNewColumn="false" isStartNewPage="true" isResetPageNumber="false" isReprintHeaderOnEachPage="false" minHeightToStartNewPage="0" >
			<groupExpression><![CDATA[$F{OURCOMPID} + "-" + $F{THEIRCOMPID}]]></groupExpression>
			<groupHeader>
			<band height="454"  isSplitAllowed="false" >
				<textField isStretchWithOverflow="false" pattern="" isBlankWhenNull="false" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
					<reportElement
						mode="Transparent"
						x="0"
						y="2"
						width="534"
						height="27"
						forecolor="#000000"
						backcolor="#FFFFFF"
						key="textField-1"
						stretchType="NoStretch"
						positionType="FixRelativeToTop"
						isPrintRepeatedValues="true"
						isRemoveLineWhenBlank="false"
						isPrintInFirstWholeBand="false"
						isPrintWhenDetailOverflows="false"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement textAlignment="Left" verticalAlignment="Top" rotation="None" lineSpacing="Single">
						<font fontName="Arial" pdfFontName="Helvetica" size="14" isBold="true" isItalic="false" isUnderline="false" isPdfEmbedded ="false" pdfEncoding ="Cp1252" isStrikeThrough="false" />
					</textElement>
				<textFieldExpression   class="java.lang.String"><![CDATA["Connection: " + $F{OURCOMPID} + " - " + $F{THEIRCOMPID}]]></textFieldExpression>
				</textField>
				<line direction="TopDown">
					<reportElement
						mode="Opaque"
						x="0"
						y="0"
						width="535"
						height="0"
						forecolor="#000000"
						backcolor="#FFFFFF"
						key="line-1"
						stretchType="NoStretch"
						positionType="FixRelativeToTop"
						isPrintRepeatedValues="true"
						isRemoveLineWhenBlank="false"
						isPrintInFirstWholeBand="false"
						isPrintWhenDetailOverflows="false"/>
					<graphicElement stretchType="NoStretch" pen="Thin" fill="Solid" />
				</line>
				<xyBarChart>
					<chart evaluationTime="Group" evaluationGroup="ConnectionGroup"  hyperlinkTarget="Self" >
					<reportElement
						mode="Opaque"
						x="0"
						y="37"
						width="535"
						height="412"
						forecolor="#000000"
						backcolor="#FFFFFF"
						key="element-2"
						stretchType="NoStretch"
						positionType="FixRelativeToTop"
						isPrintRepeatedValues="true"
						isRemoveLineWhenBlank="false"
						isPrintInFirstWholeBand="false"
						isPrintWhenDetailOverflows="false"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					</chart>
					<timeSeriesDataset timePeriod="Minute"
>
						<dataset resetType="Group" resetGroup="ConnectionGroup" />
						<timeSeries>
							<seriesExpression><![CDATA[$F{DESCRIPTION}]]></seriesExpression>
							<timePeriodExpression><![CDATA[$F{TIME}]]></timePeriodExpression>
							<valueExpression><![CDATA[new Integer($F{MSGCOUNT}.intValue() * ($F{INCOMING}.booleanValue() ? 1 : -1))]]></valueExpression>
						</timeSeries>
					</timeSeriesDataset>
					<barPlot >
						<plot />
					<valueAxisLabelExpression><![CDATA["Messages per minute (-ve = outgoing)"]]></valueAxisLabelExpression>
					</barPlot>
				</xyBarChart>
			</band>
			</groupHeader>
			<groupFooter>
			<band height="9"  isSplitAllowed="false" >
			</band>
			</groupFooter>
		</group>
		<background>
			<band height="0"  isSplitAllowed="true" >
			</band>
		</background>
		<title>
			<band height="98"  isSplitAllowed="true" >
				<staticText>
					<reportElement
						mode="Transparent"
						x="189"
						y="0"
						width="156"
						height="27"
						forecolor="#000000"
						backcolor="#FFFFFF"
						key="staticText-6"
						stretchType="NoStretch"
						positionType="FixRelativeToTop"
						isPrintRepeatedValues="true"
						isRemoveLineWhenBlank="false"
						isPrintInFirstWholeBand="false"
						isPrintWhenDetailOverflows="false"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement textAlignment="Center" verticalAlignment="Top" rotation="None" lineSpacing="Single">
						<font fontName="Arial" pdfFontName="Helvetica" size="18" isBold="true" isItalic="false" isUnderline="false" isPdfEmbedded ="false" pdfEncoding ="Cp1252" isStrikeThrough="false" />
					</textElement>
				<text><![CDATA[Messages]]></text>
				</staticText>
				<staticText>
					<reportElement
						mode="Transparent"
						x="1"
						y="42"
						width="531"
						height="52"
						forecolor="#000000"
						backcolor="#FFFFFF"
						key="staticText-7"
						stretchType="NoStretch"
						positionType="FixRelativeToTop"
						isPrintRepeatedValues="true"
						isRemoveLineWhenBlank="false"
						isPrintInFirstWholeBand="false"
						isPrintWhenDetailOverflows="false"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement textAlignment="Left" verticalAlignment="Top" rotation="None" lineSpacing="Single">
						<font fontName="Arial" pdfFontName="Helvetica" size="10" isBold="false" isItalic="false" isUnderline="false" isPdfEmbedded ="false" pdfEncoding ="Cp1252" isStrikeThrough="false" />
					</textElement>
				<text><![CDATA[This report shows the number and type of messages received in each minute over a trading day over a trading day.  Incoming messages are represented by positive values in the graph, outgoing messages are represented by negative values.]]></text>
				</staticText>
			</band>
		</title>
		<pageHeader>
			<band height="2"  isSplitAllowed="true" >
			</band>
		</pageHeader>
		<columnHeader>
			<band height="0"  isSplitAllowed="true" >
			</band>
		</columnHeader>
		<detail>
			<band height="0"  isSplitAllowed="false" >
			</band>
		</detail>
		<columnFooter>
			<band height="0"  isSplitAllowed="false" >
			</band>
		</columnFooter>
		<pageFooter>
			<band height="28"  isSplitAllowed="true" >
				<textField isStretchWithOverflow="false" pattern="" isBlankWhenNull="false" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
					<reportElement
						mode="Transparent"
						x="248"
						y="0"
						width="38"
						height="18"
						forecolor="#000000"
						backcolor="#FFFFFF"
						key="textField-6"
						stretchType="NoStretch"
						positionType="FixRelativeToTop"
						isPrintRepeatedValues="true"
						isRemoveLineWhenBlank="false"
						isPrintInFirstWholeBand="false"
						isPrintWhenDetailOverflows="false"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement textAlignment="Center" verticalAlignment="Top" rotation="None" lineSpacing="Single">
						<font fontName="Arial" pdfFontName="Helvetica" size="10" isBold="false" isItalic="false" isUnderline="false" isPdfEmbedded ="false" pdfEncoding ="Cp1252" isStrikeThrough="false" />
					</textElement>
				<textFieldExpression   class="java.lang.Integer"><![CDATA[$V{PAGE_NUMBER}]]></textFieldExpression>
				</textField>
			</band>
		</pageFooter>
		<summary>
			<band height="526"  isSplitAllowed="true" >
				<staticText>
					<reportElement
						mode="Transparent"
						x="0"
						y="2"
						width="102"
						height="27"
						forecolor="#000000"
						backcolor="#FFFFFF"
						key="staticText-1"
						stretchType="NoStretch"
						positionType="FixRelativeToTop"
						isPrintRepeatedValues="true"
						isRemoveLineWhenBlank="false"
						isPrintInFirstWholeBand="false"
						isPrintWhenDetailOverflows="false"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement textAlignment="Left" verticalAlignment="Top" rotation="None" lineSpacing="Single">
						<font fontName="Arial" pdfFontName="Helvetica" size="14" isBold="true" isItalic="false" isUnderline="false" isPdfEmbedded ="false" pdfEncoding ="Cp1252" isStrikeThrough="false" />
					</textElement>
				<text><![CDATA[Summary]]></text>
				</staticText>
				<line direction="TopDown">
					<reportElement
						mode="Opaque"
						x="0"
						y="0"
						width="535"
						height="0"
						forecolor="#000000"
						backcolor="#FFFFFF"
						key="line-2"
						stretchType="NoStretch"
						positionType="FixRelativeToTop"
						isPrintRepeatedValues="true"
						isRemoveLineWhenBlank="false"
						isPrintInFirstWholeBand="false"
						isPrintWhenDetailOverflows="false"/>
					<graphicElement stretchType="NoStretch" pen="Thin" fill="Solid" />
				</line>
				<xyBarChart>
					<chart evaluationTime="Group" evaluationGroup="ConnectionGroup"  hyperlinkTarget="Self" >
					<reportElement
						mode="Opaque"
						x="0"
						y="39"
						width="535"
						height="412"
						forecolor="#000000"
						backcolor="#FFFFFF"
						key="element-2"
						stretchType="NoStretch"
						positionType="FixRelativeToTop"
						isPrintRepeatedValues="true"
						isRemoveLineWhenBlank="false"
						isPrintInFirstWholeBand="false"
						isPrintWhenDetailOverflows="false"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					</chart>
					<timeSeriesDataset timePeriod="Minute"
>
						<dataset />
						<timeSeries>
							<seriesExpression><![CDATA[$F{DESCRIPTION}]]></seriesExpression>
							<timePeriodExpression><![CDATA[$F{TIME}]]></timePeriodExpression>
							<valueExpression><![CDATA[new Integer($F{MSGCOUNT}.intValue() * ($F{INCOMING}.booleanValue() ? 1 : -1))]]></valueExpression>
						</timeSeries>
					</timeSeriesDataset>
					<barPlot >
						<plot />
					<valueAxisLabelExpression><![CDATA["Messages per second (-ve = outgoing)"]]></valueAxisLabelExpression>
					</barPlot>
				</xyBarChart>
				<staticText>
					<reportElement
						mode="Transparent"
						x="0"
						y="469"
						width="88"
						height="16"
						forecolor="#000000"
						backcolor="#FFFFFF"
						key="staticText-8"
						stretchType="NoStretch"
						positionType="FixRelativeToTop"
						isPrintRepeatedValues="true"
						isRemoveLineWhenBlank="false"
						isPrintInFirstWholeBand="false"
						isPrintWhenDetailOverflows="false"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement textAlignment="Left" verticalAlignment="Top" rotation="None" lineSpacing="Single">
						<font fontName="Arial" pdfFontName="Helvetica" size="10" isBold="false" isItalic="false" isUnderline="false" isPdfEmbedded ="false" pdfEncoding ="Cp1252" isStrikeThrough="false" />
					</textElement>
				<text><![CDATA[Total Incoming:]]></text>
				</staticText>
				<textField isStretchWithOverflow="false" pattern="" isBlankWhenNull="false" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
					<reportElement
						mode="Transparent"
						x="95"
						y="469"
						width="49"
						height="16"
						forecolor="#000000"
						backcolor="#FFFFFF"
						key="textField-7"
						stretchType="NoStretch"
						positionType="FixRelativeToTop"
						isPrintRepeatedValues="true"
						isRemoveLineWhenBlank="false"
						isPrintInFirstWholeBand="false"
						isPrintWhenDetailOverflows="false"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement textAlignment="Left" verticalAlignment="Top" rotation="None" lineSpacing="Single">
						<font fontName="Arial" pdfFontName="Helvetica" size="10" isBold="false" isItalic="false" isUnderline="false" isPdfEmbedded ="false" pdfEncoding ="Cp1252" isStrikeThrough="false" />
					</textElement>
				<textFieldExpression   class="java.lang.Integer"><![CDATA[$V{TotalIncomingMsgCount}]]></textFieldExpression>
				</textField>
				<textField isStretchWithOverflow="false" pattern="" isBlankWhenNull="false" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
					<reportElement
						mode="Transparent"
						x="95"
						y="493"
						width="49"
						height="16"
						forecolor="#000000"
						backcolor="#FFFFFF"
						key="textField-7"
						stretchType="NoStretch"
						positionType="FixRelativeToTop"
						isPrintRepeatedValues="true"
						isRemoveLineWhenBlank="false"
						isPrintInFirstWholeBand="false"
						isPrintWhenDetailOverflows="false"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement textAlignment="Left" verticalAlignment="Top" rotation="None" lineSpacing="Single">
						<font fontName="Arial" pdfFontName="Helvetica" size="10" isBold="false" isItalic="false" isUnderline="false" isPdfEmbedded ="false" pdfEncoding ="Cp1252" isStrikeThrough="false" />
					</textElement>
				<textFieldExpression   class="java.lang.Integer"><![CDATA[$V{TotalOutgoingMsgCount}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement
						mode="Transparent"
						x="0"
						y="493"
						width="88"
						height="16"
						forecolor="#000000"
						backcolor="#FFFFFF"
						key="staticText-8"
						stretchType="NoStretch"
						positionType="FixRelativeToTop"
						isPrintRepeatedValues="true"
						isRemoveLineWhenBlank="false"
						isPrintInFirstWholeBand="false"
						isPrintWhenDetailOverflows="false"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement textAlignment="Left" verticalAlignment="Top" rotation="None" lineSpacing="Single">
						<font fontName="Arial" pdfFontName="Helvetica" size="10" isBold="false" isItalic="false" isUnderline="false" isPdfEmbedded ="false" pdfEncoding ="Cp1252" isStrikeThrough="false" />
					</textElement>
				<text><![CDATA[Total Outgoing:]]></text>
				</staticText>
			</band>
		</summary>
</jasperReport>
