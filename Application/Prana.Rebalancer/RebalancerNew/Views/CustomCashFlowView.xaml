<Window  x:Class="Prana.Rebalancer.RebalancerNew.Views.CustomCashFlowView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:shell="http://schemas.microsoft.com/winfx/2006/xaml/presentation/shell"
             xmlns:ig="http://infragistics.com/DataPresenter"
             xmlns:customChromeLibrary="clr-namespace:Prana.CustomChromeLibrary;assembly=Prana.CustomChromeLibrary"
             xmlns:themes="http://infragistics.com/Themes"
             xmlns:editors="http://infragistics.com/Editors"
             mc:Ignorable="d" 
             Height="500"
             Width="550"
             Title="Custom Cash Flow"
             x:Name="CustomCashFlowWindow"
            >

    <shell:WindowChrome.WindowChrome>
        <shell:WindowChrome
            ResizeBorderThickness="6"
            CaptionHeight="22"
            CornerRadius="5"
            GlassFrameThickness="0"/>
    </shell:WindowChrome.WindowChrome>
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Prana.Rebalancer;component/RebalancerNew/Themes/NirvanaSkin.xaml" />
                <ResourceDictionary Source="/Prana.Rebalancer;component/RebalancerNew/Themes/RebalancerTheme.xaml" />
                <ResourceDictionary Source="/Prana.Rebalancer;component/RebalancerNew/Themes/NirvanaErrorTemplate.xaml" />
                <themes:ResourceWasher WashMode="HueSaturationReplacement" WashColor="#FF6D6D6D">
                    <themes:ResourceWasher.SourceDictionary>
                        <ResourceDictionary Source="/Prana.Rebalancer;component/RebalancerNew/Themes/IG/IG.xamComboEditor.xaml" />
                    </themes:ResourceWasher.SourceDictionary>
                </themes:ResourceWasher>
                <themes:ResourceWasher WashMode="HueSaturationReplacement">
                    <themes:ResourceWasher.SourceDictionary>
                        <ResourceDictionary Source="/Prana.Rebalancer;component/RebalancerNew/Themes/IG/DataPresenterIGTheme_Express.xaml" />
                    </themes:ResourceWasher.SourceDictionary>
                </themes:ResourceWasher>
            </ResourceDictionary.MergedDictionaries>
            <Style x:Key="ButtonStyle" TargetType="{x:Type Button}">
                <Setter Property="Template" Value="{DynamicResource ButtonControlTemplate}"/>
                <Setter Property="Height" Value="20"/>
                <Setter Property="Foreground" Value="White"/>
                <Setter Property="Margin" Value="10,0,10,0" />
                <Setter Property="FontFamily" Value="Tahoma" />
                <Setter Property="FontSize" Value="12"/>
                <Setter Property="FontStyle" Value="Normal"/>
            </Style>
            <DataTemplate x:Key="StringFieldDisplayTemplate">
                <TextBlock Text="{Binding Path=(editors:TemplateEditor.Editor).Value,Mode=OneWay, RelativeSource={RelativeSource Self}, UpdateSourceTrigger=PropertyChanged}"
                           HorizontalAlignment="Left" Padding="0,0,5,0" Style="{StaticResource GridTextBlockStyle}"/>
            </DataTemplate>
            <DataTemplate x:Key="MarketValueFieldDisplayTemplate">
                <TextBlock Text="{Binding Path=(editors:TemplateEditor.Editor).Value,Mode=OneWay, RelativeSource={RelativeSource Self}, UpdateSourceTrigger=PropertyChanged,StringFormat={StaticResource StringFormatForInteger}}"
                           HorizontalAlignment="Right" Padding="0,0,5,0" Style="{StaticResource GridTextBlockStyle}" />
            </DataTemplate>
            <DataTemplate x:Key="EditableFieldDisplayTemplate">
                <TextBlock Text="{Binding Path=(editors:TemplateEditor.Editor).Value,Mode=OneWay, RelativeSource={RelativeSource Self}, UpdateSourceTrigger=PropertyChanged,StringFormat={StaticResource StringFormatForDecimal}}"
                           HorizontalAlignment="Right" Padding="0,0,5,0" Style="{StaticResource GridTextBlockStyle}"/>
            </DataTemplate>
            <DataTemplate x:Key="EditableFieldEditTemplate">
                <Border  BorderThickness="1">
                    <editors:XamNumericEditor Value="{editors:TemplateEditorValueBinding}" EditModeStarted="XamNumericEditor_EditModeStarted">
                        <editors:XamNumericEditor.Style>
                            <Style>
                                <Setter Property="editors:XamNumericEditor.IsEnabled" Value="True"/>
                                <Setter Property="editors:XamNumericEditor.Mask" Value="{}{double:-16.16}" />
                                <Setter Property="editors:XamNumericEditor.TrimFractionalZeros" Value="True" />
                                <Setter Property="editors:XamNumericEditor.PromptChar" Value="" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type ig:DataRecordCellArea}},Path=Record.DataItem.IsLock}" Value="True">
                                        <Setter Property="editors:XamNumericEditor.IsEnabled" Value="False"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type ig:DataRecordCellArea}},Path=Record.DataItem.IsCustomModel}" Value="True">
                                        <Setter Property="editors:XamNumericEditor.IsEnabled" Value="False"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type ig:DataRecordCellArea}},Path=Record.DataItem.IsCalculatedModel}" Value="True">
                                        <Setter Property="editors:XamNumericEditor.IsEnabled" Value="False"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type ig:DataRecordCellArea}},Path=Record.DataItem.IsNewlyAdded}" Value="True">
                                        <Setter Property="editors:XamNumericEditor.IsEnabled" Value="False"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </editors:XamNumericEditor.Style>
                    </editors:XamNumericEditor>
                </Border>
            </DataTemplate>

        </ResourceDictionary>
    </Window.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Border CornerRadius="2" BorderThickness="5" BorderBrush="#FF212C39" Background="#FFD1D2D4" Grid.RowSpan="2"/>
        <Border CornerRadius="2" Grid.Row="0" BorderThickness="1" BorderBrush="#FF212C39" Background="#FF212C39">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Top">
                <TextBlock x:Name="tbNirvana" Text="Nirvāna" FontFamily="Mulish" Height="22" Margin="5,0,0,0" FontSize="15" Foreground="#FFD1D2D4" VerticalAlignment="Center" />
            </StackPanel>
        </Border>
        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right">
            <TextBlock x:Name="tbCustomCashFlow" Text="Custom Cash Flow" Height="22" FontSize="14" Foreground="#FF8ABB54" VerticalAlignment="Center" HorizontalAlignment="Center" />
            <customChromeLibrary:CaptionButtons  VerticalAlignment="Center" >

            </customChromeLibrary:CaptionButtons >
        </StackPanel>
        <DockPanel Grid.Row="1" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" LastChildFill="True">
            <Grid HorizontalAlignment="Center" Margin="0,15,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <StackPanel Orientation="Horizontal" Margin="5" Grid.Row="0" VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
                    <TextBlock x:Name="tbCashFlow" Text="Cash Flow" Margin="0,3,0,0" FontWeight="Bold"/>
                    <editors:XamNumericEditor Text="{Binding CustomCashFlow}" IsReadOnly="True" Margin="10,2,0,0" Width="110" x:Name="CashFlowTextBlock" VerticalAlignment="Bottom" Style="{Binding XamNumericEditorStyle}" EditModeStarted="XamNumericEditor_EditModeStarted"/>
                    <Button x:Name="btnOK" Content="OK"  Margin="10,0,0,0" Style="{StaticResource ButtonStyle}"   Width="40" Command="{Binding CalculateCustomCashAllocationOkCommand}" Click="OkButton_OnClick"/>
                    <Button x:Name="btnFormat" Content="Format"  Margin="10,0,0,0" Style="{StaticResource ButtonStyle}"   Width="60" Command="{Binding OpenFormatCommand}" />
                    <Button x:Name="btnImport" Content="Import"  Margin="10,0,0,0" Style="{StaticResource ButtonStyle}"   Width="60" Command="{Binding ImportCommand}" />
                </StackPanel>
                <GroupBox Grid.Row="1" Grid.Column="0" Height="Auto" BorderBrush="Black" BorderThickness="2" Width="Auto" Padding="5" Margin="0,0,0,15">
                    <ig:XamDataGrid x:Name="NAVGrid" HorizontalAlignment="Stretch" Grid.Row="1" MaxWidth="480"
                                 DataSource="{Binding NAVGridData}" MaxHeight="400" GroupByAreaLocation="None" SummaryResultChanged="CustomCashFlow_OnSummaryResultChanged"
                                ScrollViewer.VerticalScrollBarVisibility="Visible" ScrollViewer.HorizontalScrollBarVisibility="Auto" >
                        <ig:XamDataGrid.Resources>
                            <Style TargetType="{x:Type ig:SummaryResultPresenter}" BasedOn="{StaticResource SummaryResultPresenterStyleForGrid}"/>
                            <Style TargetType="{x:Type ig:DataRecordCellArea}" x:Key="DataRecordCellAreaStyle" BasedOn="{StaticResource DataRecordCellAreaStyleForGrid}"/>
                            <Style TargetType="{x:Type ig:GroupBySummariesPresenter}" BasedOn="{StaticResource GroupBySummariesPresenterStyleForGrid}"/>
                            <Style TargetType="{x:Type ig:GroupByRecordPresenter}" BasedOn="{StaticResource GroupByRecordPresenterStyleForGrid}"/>
                            <Style TargetType="{x:Type ig:RecordSelector}" BasedOn="{StaticResource RecordSelectorStyle}" />
                            <Style TargetType="{x:Type ig:LabelPresenter}" BasedOn="{StaticResource LabelPresenterStyle}"/>
                            <Style TargetType="{x:Type ig:DataRecordPresenter}" BasedOn="{StaticResource DataRecordPresenterStyle}"/>
                            <Style TargetType="{x:Type ig:CellValuePresenter}" BasedOn="{StaticResource CellValuePresenterStyleForGrid}"/>
                            <Style TargetType="{x:Type ig:SummaryRecordContentArea}">
                                <Setter Property="Height" Value="0"/>
                            </Style>
                        </ig:XamDataGrid.Resources>
                        <ig:XamDataGrid.FieldSettings>
                            <ig:FieldSettings AllowSummaries="True"  SummaryDisplayArea="Bottom"  AllowRecordFiltering="True"/>
                        </ig:XamDataGrid.FieldSettings>
                        <ig:XamDataGrid.FieldLayoutSettings>
                            <ig:FieldLayoutSettings AutoGenerateFields="False" RecordSelectorLocation="None" FilterUIType="LabelIcons"  AllowClipboardOperations="Copy" HighlightAlternateRecords="True">
                                <ig:FieldLayoutSettings.DataRecordCellAreaStyle>
                                    <Style TargetType="{x:Type ig:DataRecordCellArea}" BasedOn="{StaticResource DataRecordCellAreaStyle}"/>
                                </ig:FieldLayoutSettings.DataRecordCellAreaStyle>
                            </ig:FieldLayoutSettings>
                        </ig:XamDataGrid.FieldLayoutSettings>
                        <ig:XamDataGrid.FieldLayouts>
                            <ig:FieldLayout>
                                <ig:FieldLayout.SummaryDefinitions>
                                    <ig:SummaryDefinition SourceFieldName="CustomCashFlow" Calculator="Sum" DisplayArea="TopFixed" StringFormat="{}{0:#,0.####}"/>
                                </ig:FieldLayout.SummaryDefinitions>
                                <ig:TemplateField Label="Account" Name="AccountName" Width="200" Height="25" DisplayTemplate="{StaticResource StringFieldDisplayTemplate}"/>
                                <ig:TemplateField Label="NAV" Name="CurrentTotalNAV" Width="110" Height="25" DisplayTemplate="{StaticResource MarketValueFieldDisplayTemplate}"/>
                                <ig:TemplateField Label="Cash Flow" Name="CustomCashFlow" AllowEdit="True" Width="120" Height="25"  DisplayTemplate="{StaticResource EditableFieldDisplayTemplate}" EditTemplate="{StaticResource EditableFieldEditTemplate}"/>
                            </ig:FieldLayout>
                        </ig:XamDataGrid.FieldLayouts>
                    </ig:XamDataGrid>
                </GroupBox>
            </Grid>
        </DockPanel>
    </Grid>
</Window>
